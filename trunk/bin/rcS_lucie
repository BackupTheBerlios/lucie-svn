#!/usr/bin/ruby1.8
#
# $Id: command-line-options.rb 557 2005-04-13 07:05:05Z takamiya $
#
# Author::   Yasuhito Takamiya (mailto:yasuhito@gmail.com)
# Revision:: $Revision: 557 $
# License::  GPL2


require 'lucie'
require 'popen3/shell'

include Lucie

info "Creating a writable area on the install client."

sh_exec "mount -n -t proc proc /proc"
sh_exec "mount -t tmpfs tmpfs /tmp"
sh_exec "mkdir -p /tmp/etc /tmp/target"

def mkrw dirs
  dirs.each do | each |
    unless FileTest.directory?( each )
      next
    end
    if FileTest.writable?( each )
      next
    end

    tempfile = `mktemp`
    sh_exec "tar -C #{ each } -cf #{ tempfile } ."
    sh_exec "mount -n -o size=10m tmpfs tmpfs #{ each }"
    sh_exec "tar -C #{ each } -xf #{ tmpfile }"
    sh_exec "rm -f #{ tmpfile }"
  end
end

mkrw %w(/dev /var/run /var/log /var/lock /var/discover /var/lib/discover /etc/sysconfig /etc/lvm)


### Local variables:
### mode: Ruby
### indent-tabs-mode: nil
### End:
